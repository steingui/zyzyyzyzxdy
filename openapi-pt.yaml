openapi: 3.0.0
info:
  title: BR-Statistics Hub API (PT-BR)
  description: |
    **API de Estatísticas do Futebol Brasileiro - Brasileirão**
    
    Esta API fornece dados detalhados sobre partidas, times e estatísticas de desempenho do futebol brasileiro.
    Perfeita para analistas esportivos, cientistas de dados e entusiastas de apostas esportivas que precisam de dados confiáveis e métricas avançadas.
    
    **Recursos Principais:**
    - Resultados reais de partidas com gols, placares e horários
    - Expected Goals (xG) - métrica que mostra quantos gols um time "deveria ter marcado" baseado na qualidade das chances
    - Rankings de desempenho de times e dados históricos
    - Eventos de partidas (gols, cartões, substituições)
    - Informações de público e árbitros
    
    **Casos de Uso para Apostas Esportivas:**
    - Analisar força ofensiva/defensiva dos times (métricas xG)
    - Comparar desempenho como mandante vs visitante
    - Identificar padrões de pontuação e tendências
    - Avaliar consistência dos times ao longo das rodadas
    
  version: 3.1.0
  contact:
    name: BR-Statistics Hub
    url: https://github.com/steingui/zyzyyzyzxdy

servers:
  - url: http://127.0.0.1:5000
    description: Servidor de desenvolvimento local
  - url: http://localhost:5000
    description: Localhost

tags:
  - name: Geral
    description: Endpoints gerais de saúde e status da API
  - name: Partidas
    description: |
      Obtenha informações detalhadas sobre partidas incluindo placar, estatísticas e eventos.
      Essencial para análise de desempenho passado e previsão de resultados futuros.
  - name: Times
    description: |
      Acesse perfis de times e dados históricos.
      Útil para comparar times antes de fazer apostas.
  - name: Análises
    description: |
      Estatísticas avançadas e rankings usando métricas de Expected Goals (xG).
      Essas métricas ajudam a identificar times que estão performando acima ou abaixo de seus resultados reais.
  - name: Scraping
    description: |
      Controle remoto do pipeline de scraping. Dispare jobs de coleta de dados para qualquer liga/rodada via HTTP.
      Monitore status de jobs e acompanhe o progresso do scraping em tempo real.

paths:
  /health:
    get:
      tags:
        - Geral
      summary: Verificar se a API está online
      description: Use isto para verificar se a API está funcionando antes de fazer outras requisições
      responses:
        '200':
          description: API está saudável e pronta para uso
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  version:
                    type: string
                    example: 3.0.0

  /api/matches:
    get:
      tags:
        - Partidas
      summary: Obter lista de partidas com filtros opcionais
      description: |
        **O que você recebe:** Lista de todas as partidas com placares, times e informações básicas.
        
        **Por que é útil para apostas:**
        - Veja como os times performaram nas rodadas recentes
        - Compare resultados como mandante vs visitante
        - Identifique padrões de pontuação (partidas com muitos/poucos gols)
        
        **Opções de filtro:**
        - Por número da rodada - veja todas as partidas de uma rodada específica
        - Por ID do time - veja todas as partidas de um time específico (mandante ou visitante)
        
        **Exemplos de uso:**
        - "Mostre todas as partidas da Rodada 10" → Filtrar por rodada=10
        - "Mostre todas as partidas do Flamengo" → Filtrar por time_id=1
      parameters:
        - name: rodada
          in: query
          description: Filtrar por número da rodada do campeonato (1-38)
          required: false
          schema:
            type: integer
            example: 1
        - name: time_id
          in: query
          description: Filtrar por ID do time - mostra partidas onde este time jogou (mandante ou visitante)
          required: false
          schema:
            type: integer
            example: 5
      responses:
        '200':
          description: Lista de partidas que correspondem aos seus filtros
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Partida'

  /api/matches/{match_id}:
    get:
      tags:
        - Partidas
      summary: Obter detalhes completos de uma partida específica
      description: |
        **O que você recebe:** Tudo sobre uma partida - placares, estatísticas, eventos (gols, cartões), árbitro, estádio, público.
        
        **Por que é útil para apostas:**
        - Mergulhe fundo nas estatísticas da partida (posse, chutes, xG)
        - Veja quando os gols foram marcados (padrões de início/fim de jogo)
        - Confira influência do árbitro e público
        - Entenda o fluxo da partida através da linha do tempo de eventos
        
        **Principais estatísticas explicadas:**
        - **xG (Expected Goals)**: Mede a qualidade das finalizações. xG de 2.5 significa que o time criou chances valendo 2.5 gols
        - **Posse**: Percentual de controle de bola. Posse alta nem sempre significa mais gols!
        - **Chutes no gol**: Tentativas perigosas de verdade que testaram o goleiro
        
        **Exemplo de uso:** Antes de apostar no próximo jogo do Flamengo, confira as últimas 3 partidas para ver as tendências de xG
      parameters:
        - name: match_id
          in: path
          description: Identificador único da partida (obtenha da lista /api/matches)
          required: true
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Detalhes completos da partida com estatísticas e eventos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PartidaDetalhada'
        '404':
          description: Partida não encontrada - verifique se o match_id está correto

  /api/teams:
    get:
      tags:
        - Times
      summary: Obter lista de todos os times do campeonato
      description: |
        **O que você recebe:** Lista de todos os 20 times do Brasileirão com seus IDs.
        
        **Por que é útil:**
        - Obtenha IDs dos times para usar em outros endpoints (como filtrar partidas)
        - Veja todos os times atualmente no campeonato
        
        **Nota:** Use o ID do time para buscar estatísticas detalhadas daquele time
      responses:
        '200':
          description: Lista de todos os times
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Time'

  /api/teams/{team_id}:
    get:
      tags:
        - Times
      summary: Obter informações de um time específico
      description: |
        **O que você recebe:** Nome do time, URL do escudo e data de criação.
        
        **Dica profissional:** Combine isto com /api/matches?time_id={team_id} para obter todas as partidas deste time,
        e então analise as tendências de desempenho.
      parameters:
        - name: team_id
          in: path
          description: Identificador do time (obtenha da lista /api/teams)
          required: true
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Detalhes do time
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Time'
        '404':
          description: Time não encontrado - verifique se o team_id existe

  /api/analytics/ranking-xg:
    get:
      tags:
        - Análises
      summary: Ranking de times baseado em Expected Goals (xG)
      description: |
        **O que você recebe:** Times ranqueados por sua qualidade ofensiva e defensiva usando métricas xG.
        
        **O que é xG?**
        Expected Goals mede a qualidade das chances criadas. Um chute de dentro da área tem xG maior que um chute de 30 metros.
        
        **Como usar para apostas:**
        - **avg_xg_for (Ataque)**: Quantas chances de qualidade o time cria por partida
          - Alto = Ataque forte, cria muitas chances perigosas
          - Baixo = Ataque fraco, dificuldade em criar boas oportunidades
        
        - **avg_xg_against (Defesa)**: Quantas chances de qualidade o time concede por partida
          - Alto = Defesa fraca, permite muitos chutes perigosos
          - Baixo = Defesa forte, limita chances do adversário
        
        **Insights para apostas:**
        - Time com alto xG_for mas poucos gols reais → Azarado, pode melhorar em breve (aposta de valor)
        - Time com baixo xG_for mas muitos gols → Sortudo, pode regredir à média
        - Alto xG_against → Defesa vulnerável, bom para apostas "Ambas marcam"
        
        **Exemplo:** Se o Flamengo tem avg_xg_for=2.5 mas só marca 1.5 gols/jogo, é provável que melhore.
      responses:
        '200':
          description: Times ranqueados por desempenho de Expected Goals
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RankingXG'

  /api/analytics/summary:
    get:
      tags:
        - Análises
      summary: Estatísticas gerais do campeonato
      description: |
        **O que você recebe:** Estatísticas de alto nível sobre toda a temporada do Brasileirão.
        
        **Métricas incluídas:**
        - **total_matches**: Quantas partidas foram jogadas
        - **total_goals**: Total de gols marcados no campeonato
        - **avg_goals**: Média de gols por partida
        
        **Por que é útil para apostas:**
        - **avg_goals** ajuda a definir expectativas para apostas Over/Under
          - Se a média é 2.5 gols/partida, apostar em Over 2.5 é arriscado
          - Se a média é 3.2 gols/partida, a liga tem padrão de muitos gols
        
        - Compare xG de partidas individuais com a média da liga para identificar outliers
        - Entenda se esta temporada é de muitos gols ou defensiva
        
        **Exemplo de uso:** Média da liga é 2.8 gols → Ambos os times têm média de 1.5 xG → Total 3.0 xG → Aposte em Acima de 2.5 gols
      responses:
        '200':
          description: Estatísticas resumidas do campeonato
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Summary'

  /api/scrape:
    post:
      tags:
        - Scraping
      summary: Iniciar job de scraping para uma liga/rodada específica
      description: |
        **O que faz:** Dispara o pipeline de scraping para coletar dados de partidas do ogol.com.br
        
        **Parâmetros:**
        - **league**: Slug da liga (ex: "brasileirao", "premier-league", "la-liga")
        - **year**: Ano da temporada (ex: 2026)
        - **round**: Número da rodada (1-38)
        
        **Retorna:** ID do job para rastreamento do progresso
        
        **Como funciona:**
        1. Valida se a liga existe no banco de dados
        2. Valida se a rodada está dentro do máximo de rodadas da liga
        3. Inicia subprocess assíncrono para scraping
        4. Retorna imediatamente com job_id
        5. Verifique o status com GET /api/scrape/status/{job_id}
        
        **Nota:** Job roda em background. Não iniciará jobs duplicados para mesma liga/rodada.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - round
              properties:
                league:
                  type: string
                  default: brasileirao
                  example: brasileirao
                year:
                  type: integer
                  default: 2026
                  example: 2026
                round:
                  type: integer
                  example: 1
                sync:
                  type: boolean
                  default: false
                  example: false
                  description: Se verdadeiro, executa sincronicamente (aguarda finalização)
      responses:
        '202':
          description: Job de scraping iniciado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScrapeJobStarted'
        '400':
          description: Parâmetros inválidos (rodada ausente, liga inválida, ou rodada fora do limite)
        '409':
          description: Job já em execução para esta liga/rodada

  /api/scrape/status/{job_id}:
    get:
      tags:
        - Scraping
      summary: Obter status de um job de scraping
      description: |
        **O que faz:** Verifica se seu job de scraping ainda está rodando ou foi concluído
        
        **Valores de status:**
        - **running**: Job está ativamente fazendo scraping de partidas
        - **completed**: Job finalizado com sucesso
        - **cancelled**: Job foi cancelado pelo usuário
        
        **Resposta inclui:**
        - Timestamps de início/conclusão
        - Duração em segundos
        - Contagem de partidas scraped/falhadas
        - Caminho do arquivo de log para troubleshooting
      parameters:
        - name: job_id
          in: path
          required: true
          description: Identificador do job retornado por POST /api/scrape
          schema:
            type: string
            example: scrape_brasileirao_2026_1_1738354845
      responses:
        '200':
          description: Status e detalhes do job
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ScrapeJob'
        '404':
          description: Job não encontrado

  /api/scrape/jobs:
    get:
      tags:
        - Scraping
      summary: Listar todos os jobs de scraping
      description: |
        **O que faz:** Obtém lista de todos os jobs de scraping (em execução e concluídos)
        
        **Opções de filtro:**
        - Por status (running, completed, cancelled)
        - Por liga
        - Limitar resultados (padrão: 50, máximo: 100)
        
        **Ordenação:** Jobs mais recentes primeiro
      parameters:
        - name: status
          in: query
          description: Filtrar por status do job
          required: false
          schema:
            type: string
            enum: [running, completed, cancelled]
        - name: league
          in: query
          description: Filtrar por slug da liga
          required: false
          schema:
            type: string
            example: brasileirao
        - name: limit
          in: query
          description: Número máximo de resultados
          required: false
          schema:
            type: integer
            default: 50
            maximum: 100
      responses:
        '200':
          description: Lista de jobs
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                  jobs:
                    type: array
                    items:
                      $ref: '#/components/schemas/ScrapeJob'

  /api/scrape/cancel/{job_id}:
    post:
      tags:
        - Scraping
      summary: Cancelar um job de scraping em execução
      description: |
        **O que faz:** Para um job de scraping que está atualmente em execução
        
        **Nota:** Só pode cancelar jobs com status="running"
      parameters:
        - name: job_id
          in: path
          required: true
          description: Identificador do job a cancelar
          schema:
            type: string
            example: scrape_brasileirao_2026_1_1738354845
      responses:
        '200':
          description: Job cancelado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: cancelled
                  job_id:
                    type: string
                  message:
                    type: string
        '400':
          description: Job não está em execução
        '404':
          description: Job não encontrado

components:
  schemas:
    Time:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: Flamengo
        shield_url:
          type: string
          nullable: true
          example: null
        created_at:
          type: string
          format: date-time

    Partida:
      type: object
      properties:
        id:
          type: integer
          example: 1
        round:
          type: integer
          example: 1
        home_team:
          $ref: '#/components/schemas/TimeSimples'
        away_team:
          $ref: '#/components/schemas/TimeSimples'
        goals_home:
          type: integer
          example: 2
        goals_away:
          type: integer
          example: 1
        datetime:
          type: string
          format: date-time
          nullable: true
        status:
          type: string
          example: finished

    PartidaDetalhada:
      allOf:
        - $ref: '#/components/schemas/Partida'
        - type: object
          properties:
            stadium:
              type: object
              properties:
                id:
                  type: integer
                name:
                  type: string
            referee:
              type: object
              properties:
                id:
                  type: integer
                name:
                  type: string
            statistics:
              $ref: '#/components/schemas/Estatisticas'
            events:
              type: array
              items:
                $ref: '#/components/schemas/Evento'

    TimeSimples:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string

    Estatisticas:
      type: object
      properties:
        possession_home:
          type: integer
          example: 52
        possession_away:
          type: integer
          example: 48
        xg_home:
          type: number
          format: float
          example: 1.56
        xg_away:
          type: number
          format: float
          example: 1.78
        shots_home:
          type: integer
          example: 12
        shots_away:
          type: integer
          example: 8

    Evento:
      type: object
      properties:
        id:
          type: integer
        type:
          type: string
          example: goal
        minute:
          type: integer
          example: 34
        team:
          $ref: '#/components/schemas/TimeSimples'
        player:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string

    RankingXG:
      type: object
      properties:
        team:
          type: string
          example: Flamengo
        matches:
          type: integer
          example: 10
        avg_xg_for:
          type: number
          format: float
          example: 1.85
        avg_xg_against:
          type: number
          format: float
          example: 1.22

    Summary:
      type: object
      properties:
        total_matches:
          type: integer
          example: 100
        total_goals:
          type: integer
          example: 250
        avg_goals:
          type: number
          format: float
          example: 2.5

    ScrapeJobStarted:
      type: object
      properties:
        status:
          type: string
          example: started
        job_id:
          type: string
          example: scrape_brasileirao_2026_1_1738354845
        league:
          type: string
          example: brasileirao
        league_name:
          type: string
          example: Brasileirão Série A
        year:
          type: integer
          example: 2026
        round:
          type: integer
          example: 1
        message:
          type: string
          example: Scraping job started successfully
        log_file:
          type: string
          example: logs/scrape_brasileirao_2026_r1.log

    ScrapeJob:
      type: object
      properties:
        job_id:
          type: string
          example: scrape_brasileirao_2026_1_1738354845
        status:
          type: string
          enum: [running, completed, cancelled]
          example: completed
        league:
          type: string
          example: brasileirao
        league_name:
          type: string
          example: Brasileirão Série A
        year:
          type: integer
          example: 2026
        round:
          type: integer
          example: 1
        started_at:
          type: string
          format: date-time
          example: 2026-01-31T19:00:45Z
        completed_at:
          type: string
          format: date-time
          nullable: true
          example: 2026-01-31T19:05:30Z
        duration_seconds:
          type: integer
          nullable: true
          example: 285
        pid:
          type: integer
          example: 12345
        log_file:
          type: string
          example: logs/scrape_brasileirao_2026_r1.log
        matches_scraped:
          type: integer
          example: 10
        matches_failed:
          type: integer
          example: 0
