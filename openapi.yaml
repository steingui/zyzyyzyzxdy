openapi: 3.0.0
info:
  title: BR-Statistics Hub API
  description: API para consulta de estatísticas do futebol brasileiro (Brasileirão)
  version: 2.0.0
  contact:
    name: BR-Statistics Hub
    url: https://github.com/steingui/zyzyyzyzxdy

servers:
  - url: http://127.0.0.1:5000
    description: Servidor de desenvolvimento local
  - url: http://localhost:5000
    description: Localhost

tags:
  - name: General
    description: Endpoints gerais
  - name: Matches
    description: Operações relacionadas a partidas
  - name: Teams
    description: Operações relacionadas a times
  - name: Analytics
    description: Análises e estatísticas avançadas

paths:
  /health:
    get:
      tags:
        - General
      summary: Health check
      description: Verifica o status da API
      responses:
        '200':
          description: API está funcionando
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  version:
                    type: string
                    example: 2.0.0

  /api/matches:
    get:
      tags:
        - Matches
      summary: Listar partidas
      description: Retorna lista de partidas com filtros opcionais
      parameters:
        - name: rodada
          in: query
          description: Filtrar por rodada específica
          required: false
          schema:
            type: integer
            example: 1
        - name: time_id
          in: query
          description: Filtrar por ID de time (casa ou fora)
          required: false
          schema:
            type: integer
            example: 5
      responses:
        '200':
          description: Lista de partidas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Partida'

  /api/matches/{match_id}:
    get:
      tags:
        - Matches
      summary: Detalhes de uma partida
      description: Retorna informações detalhadas de uma partida específica
      parameters:
        - name: match_id
          in: path
          description: ID da partida
          required: true
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Detalhes da partida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PartidaDetalhada'
        '404':
          description: Partida não encontrada

  /api/teams:
    get:
      tags:
        - Teams
      summary: Listar times
      description: Retorna lista de todos os times cadastrados
      responses:
        '200':
          description: Lista de times
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Time'

  /api/teams/{team_id}:
    get:
      tags:
        - Teams
      summary: Detalhes de um time
      description: Retorna informações de um time específico
      parameters:
        - name: team_id
          in: path
          description: ID do time
          required: true
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Detalhes do time
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Time'
        '404':
          description: Time não encontrado

  /api/analytics/ranking-xg:
    get:
      tags:
        - Analytics
      summary: Ranking por Expected Goals (xG)
      description: Retorna ranking de performance dos times baseado em xG
      responses:
        '200':
          description: Ranking de xG
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RankingXG'

  /api/analytics/summary:
    get:
      tags:
        - Analytics
      summary: Resumo da temporada
      description: Retorna estatísticas gerais da temporada
      responses:
        '200':
          description: Resumo da temporada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Summary'

components:
  schemas:
    Time:
      type: object
      properties:
        id:
          type: integer
          example: 1
        nome:
          type: string
          example: Flamengo
        escudo_url:
          type: string
          nullable: true
          example: null
        created_at:
          type: string
          format: date-time

    Partida:
      type: object
      properties:
        id:
          type: integer
          example: 1
        rodada:
          type: integer
          example: 1
        time_casa:
          $ref: '#/components/schemas/TimeSimples'
        time_fora:
          $ref: '#/components/schemas/TimeSimples'
        gols_casa:
          type: integer
          example: 2
        gols_fora:
          type: integer
          example: 1
        data_hora:
          type: string
          format: date-time
          nullable: true
        status:
          type: string
          example: finished

    PartidaDetalhada:
      allOf:
        - $ref: '#/components/schemas/Partida'
        - type: object
          properties:
            estadio:
              type: object
              properties:
                id:
                  type: integer
                nome:
                  type: string
            arbitro:
              type: object
              properties:
                id:
                  type: integer
                nome:
                  type: string
            estatisticas:
              $ref: '#/components/schemas/Estatisticas'
            eventos:
              type: array
              items:
                $ref: '#/components/schemas/Evento'

    TimeSimples:
      type: object
      properties:
        id:
          type: integer
        nome:
          type: string

    Estatisticas:
      type: object
      properties:
        posse_casa:
          type: integer
          example: 52
        posse_fora:
          type: integer
          example: 48
        xg_casa:
          type: number
          format: float
          example: 1.56
        xg_fora:
          type: number
          format: float
          example: 1.78
        chutes_casa:
          type: integer
          example: 12
        chutes_fora:
          type: integer
          example: 8

    Evento:
      type: object
      properties:
        id:
          type: integer
        tipo:
          type: string
          example: gol
        minuto:
          type: integer
          example: 34
        time:
          $ref: '#/components/schemas/TimeSimples'
        jogador:
          type: object
          properties:
            id:
              type: integer
            nome:
              type: string

    RankingXG:
      type: object
      properties:
        time:
          type: string
          example: Flamengo
        jogos:
          type: integer
          example: 10
        xg_favor_medio:
          type: number
          format: float
          example: 1.85
        xg_contra_medio:
          type: number
          format: float
          example: 1.22

    Summary:
      type: object
      properties:
        total_jogos:
          type: integer
          example: 100
        total_gols:
          type: integer
          example: 250
        media_gols:
          type: number
          format: float
          example: 2.5
